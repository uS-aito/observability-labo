# 目的
既存のECSタスクにotel collectorおよび関連サイドカーを導入し、既存タスクに影響を与えない形でotel collectorでログを収集できるようにする。

# 構成
* app: アプリケーションのコンテナ
* firelens: ログルータ、appのログを受信してルーティングする
* otel-collector: firelensが送信してきたログを受信して処理する

# 結論
上記の構成にすることで、既存のECSタスクには影響を与えないが、ECSタスク関連のオペレーションへの影響が発生することがわかった。

ECSタスクのログはログタブから確認することができるが、ここで確認できるのはawslogsログドライバに送信されたログのみである。したがって、appのログドライバをfirelensに変更した時点でログタブからログを確認することはできない。

firelensによってログはこれまでと同じロググループに送信されているので、そちらからログを確認することはできる。ただしログのフォーマットが異なっている。
* awslogs: ![](images/2026-01-24-18-49-06.png)
  * ログのみが表示されている
* firelens: ![](images/2026-01-24-18-49-47.png)
  * ログの他にメタデータも付与されており、構造化されている

ログの内容それ自体は変わっていない。

アプリのログドライバをawslogsのままにする場合、otel collectorはそのままではログを収集することができない。一応、`awscloudwatchreceiver`を使用してcloudwatch logsを参照するという方法があることはあるが、APIリクエスト料金がかかるほか、API制限が生じるので現実的とは言えない。

また、ログだけ見るならサブスクリプションフィルター(LambdaやKinesis Data Firehose経由で外部（OTel Collectorやバックエンド）に転送)を使うというてもある。